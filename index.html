<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Duyuru Wordle</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #fafafa;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            flex-direction: column;
            overflow: hidden;
        }

        /* ===== BOARD & EFFECTS ===== */
        .board-wrapper { position: relative; display: inline-block; }
        .heart-layer { position: fixed; inset: 0; overflow: hidden; pointer-events: none; z-index: 5; }
        
        .heart, .confetti {
            position: absolute;
            bottom: -50px;
            animation: floatUp linear forwards;
        }

        @keyframes floatUp {
            from { transform: translateY(0) rotate(0deg); opacity: 1; }
            to { transform: translateY(-120vh) rotate(360deg); opacity: 0; }
        }

        .board {
            display: grid;
            grid-template-rows: repeat(6, 1fr);
            gap: 5px;
            z-index: 1;
        }

        .row { display: grid; grid-template-columns: repeat(5, 60px); gap: 5px; }

        .cell {
            width: 60px;
            height: 60px;
            border: 2px solid #d3d6da;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            background: white;
            text-transform: uppercase;
            transition: transform 0.1s;
        }

        .cell.pop { transform: scale(1.1); border-color: #878a8c; }

        /* Renkler */
        .correct { background: #6aaa64 !important; color: white; border-color: #6aaa64; }
        .present { background: #c9b458 !important; color: white; border-color: #c9b458; }
        .absent  { background: #787c7e !important; color: white; border-color: #787c7e; }

        /* ===== KEYBOARD ===== */
        .keyboard { margin-top: 25px; width: 100%; max-width: 500px; padding: 0 10px; }
        .keyboard-row { display: flex; justify-content: center; margin-bottom: 8px; touch-action: manipulation; }
        .key {
            background: #d3d6da;
            border: 0;
            border-radius: 4px;
            margin: 2px;
            padding: 15px 10px;
            cursor: pointer;
            font-weight: bold;
            flex: 1;
            transition: background 0.2s;
        }
        .key.wide { flex: 1.5; }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            max-width: 320px;
            width: 90%;
        }
        #modalEmojis { margin: 20px 0; font-family: monospace; line-height: 1.2; font-size: 1.2rem; }
        #copyButton {
            background: #6aaa64;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        #devTag { position: fixed; right: 10px; bottom: 10px; background: #ffea00; padding: 5px; cursor: pointer; font-size: 10px; }
    </style>
</head>
<body>

<h1>Duyuru Wordle 0.64</h1>

<div class="heart-layer" id="heartLayer"></div>

<div class="board-wrapper">
    <div class="board" id="board"></div>
</div>

<div class="keyboard" id="keyboard"></div>

<div id="resultModal" class="modal">
    <div class="modal-content">
        <h2 id="modalTitle">SonuÃ§</h2>
        <div id="modalMessage"></div>
        <pre id="modalEmojis"></pre>
        <button id="copyButton">Kopyala ve PaylaÅŸ</button>
    </div>
</div>

<div id="devTag">DEV MODE</div>

<script>
/* ================= CONFIG & STATE ================= */
let WORD_LIST = [];
let WORD = "";
let currentRow = 0;
let currentCol = 0;
let gameOver = false;
let boardState = []; // Emojiler iÃ§in sonucu tutar
const DEV_MODE = localStorage.getItem("duyuruDevMode") === "true";

/* ================= HEART ENGINE ================= */
let heartLevel = 1;
function spawnEffect(emoji, count = 1) {
    const layer = document.getElementById("heartLayer");
    for (let i = 0; i < count; i++) {
        const h = document.createElement("div");
        h.className = "heart";
        h.textContent = emoji;
        h.style.left = Math.random() * 95 + "%";
        h.style.fontSize = (15 + Math.random() * 20) + "px";
        h.style.animationDuration = (3 + Math.random() * 3) + "s";
        layer.appendChild(h);
        setTimeout(() => h.remove(), 6000);
    }
}

/* ================= CORE LOGIC ================= */
function normalizeTurkish(str) {
    return str.replace(/i/g,'Ä°').replace(/Ä±/g,'I')
              .replace(/ÅŸ/g,'Åž').replace(/Ã§/g,'Ã‡')
              .replace(/Ã¼/g,'Ãœ').replace(/Ã¶/g,'Ã–')
              .replace(/ÄŸ/g,'Äž').toUpperCase();
}

async function getDailyWord() {
    const now = new Date();
    const dateStr = now.toISOString().slice(0,10); 
    const data = new TextEncoder().encode(dateStr);
    const hash = await crypto.subtle.digest("SHA-256", data);
    const arr = Array.from(new Uint8Array(hash));
    const idx = arr.reduce((a,v)=> (a*31+v)%WORD_LIST.length,0);
    return WORD_LIST[idx];
}

/* ===== INIT ===== */
fetch("words.json") // words.json dosyanÄ±zÄ±n aynÄ± dizinde olduÄŸundan emin olun
    .then(r => r.json())
    .then(async list => {
        WORD_LIST = list.map(w => normalizeTurkish(w.trim()));
        WORD = await getDailyWord();
        if (DEV_MODE) console.log("CEVAP:", WORD);
        initGame();
    }).catch(err => {
        console.error("Kelime listesi yÃ¼klenemedi!", err);
        alert("LÃ¼tfen words.json dosyasÄ±nÄ±n sunucuda olduÄŸundan emin olun.");
    });

function initGame() {
    // Board OluÅŸtur
    const boardDiv = document.getElementById("board");
    for (let r = 0; r < 6; r++) {
        const row = document.createElement("div");
        row.className = "row";
        for (let c = 0; c < 5; c++) {
            const cell = document.createElement("div");
            cell.className = "cell";
            cell.id = `cell-${r}-${c}`;
            row.appendChild(cell);
        }
        boardDiv.appendChild(row);
    }

    // Klavye OluÅŸtur
    const keys = [
        ["Q","W","E","R","T","Y","U","I","O","P","Äž","Ãœ"],
        ["A","S","D","F","G","H","J","K","L","Åž","Ä°"],
        ["ENTER","Z","X","C","V","B","N","M","Ã–","Ã‡","DEL"]
    ];
    const kbDiv = document.getElementById("keyboard");
    keys.forEach(row => {
        const rDiv = document.createElement("div");
        rDiv.className = "keyboard-row";
        row.forEach(key => {
            const btn = document.createElement("button");
            btn.className = "key" + (key.length > 1 ? " wide" : "");
            btn.textContent = key;
            btn.dataset.key = normalizeTurkish(key);
            btn.onclick = () => handleInput(key);
            rDiv.appendChild(btn);
        });
        kbDiv.appendChild(rDiv);
    });

    // Klavye Event Listener
    document.addEventListener("keydown", (e) => {
        if (e.ctrlKey || e.metaKey || e.altKey) return;
        if (e.key === "Enter") handleInput("ENTER");
        else if (e.key === "Backspace") handleInput("DEL");
        else {
            const key = normalizeTurkish(e.key);
            if (key.length === 1 && "ABCÃ‡DEFGÄžHIÄ°JKLMNOÃ–PRSÅžTUÃœVYZXWQ".includes(key)) {
                handleInput(key);
            }
        }
    });

    if (DEV_MODE) document.getElementById("devTag").style.display = "block";
}

function handleInput(k) {
    if (gameOver) return;
    k = normalizeTurkish(k);

    if (k === "DEL") {
        if (currentCol > 0) {
            currentCol--;
            const cell = document.getElementById(`cell-${currentRow}-${currentCol}`);
            cell.textContent = "";
            cell.classList.remove("pop");
        }
    } else if (k === "ENTER") {
        submitGuess();
    } else if (currentCol < 5) {
        const cell = document.getElementById(`cell-${currentRow}-${currentCol}`);
        cell.textContent = k;
        cell.classList.add("pop");
        currentCol++;
    }
}

function submitGuess() {
    if (currentCol < 5) return;

    const guess = Array.from({length: 5}, (_, i) => 
        document.getElementById(`cell-${currentRow}-${i}`).textContent
    ).join("");

    if (!WORD_LIST.includes(guess)) {
        alert("SÃ¶zlÃ¼kte bulunamadÄ±!");
        return;
    }

    const results = checkGuess(guess);
    updateUI(results, guess);

    if (guess === WORD) {
        endGame(true);
    } else if (currentRow === 5) {
        endGame(false);
    } else {
        currentRow++;
        currentCol = 0;
        spawnEffect("ðŸ’”", 5);
    }
}

function checkGuess(guess) {
    const res = Array(5).fill("absent");
    const target = WORD.split("");
    const gArr = guess.split("");

    // Ã–nce YeÅŸiller
    for (let i = 0; i < 5; i++) {
        if (gArr[i] === target[i]) {
            res[i] = "correct";
            target[i] = null;
        }
    }
    // Sonra SarÄ±lar
    for (let i = 0; i < 5; i++) {
        if (res[i] !== "correct" && target.includes(gArr[i])) {
            res[i] = "present";
            target[target.indexOf(gArr[i])] = null;
        }
    }
    return res;
}

function updateUI(results, guess) {
    let emojiRow = "";
    results.forEach((r, i) => {
        const cell = document.getElementById(`cell-${currentRow}-${i}`);
        cell.classList.add(r);
        
        // Sanal Klavye GÃ¼ncelleme
        const keyBtn = document.querySelector(`.key[data-key="${guess[i]}"]`);
        if (keyBtn) {
            if (r === "correct") {
                keyBtn.classList.remove("present", "absent");
                keyBtn.classList.add("correct");
            } else if (r === "present" && !keyBtn.classList.contains("correct")) {
                keyBtn.classList.add("present");
            } else if (r === "absent" && !keyBtn.classList.contains("correct") && !keyBtn.classList.contains("present")) {
                keyBtn.classList.add("absent");
            }
        }

        // Emoji SatÄ±rÄ± OluÅŸtur
        emojiRow += (r === "correct" ? "ðŸŸ©" : r === "present" ? "ðŸŸ¨" : "â¬›");
    });
    boardState.push(emojiRow);
}

function endGame(win) {
    gameOver = true;
    if (win) {
        spawnEffect("ðŸ’—", 50);
        document.getElementById("modalTitle").textContent = "Tebrikler! ðŸŽ‰";
        document.getElementById("modalMessage").textContent = `${currentRow + 1}. denemede bildin.`;
    } else {
        document.getElementById("modalTitle").textContent = "ÃœzgÃ¼nÃ¼m... ðŸ˜”";
        document.getElementById("modalMessage").textContent = `DoÄŸru kelime: ${WORD}`;
    }

    const modal = document.getElementById("resultModal");
    const emojiContainer = document.getElementById("modalEmojis");
    emojiContainer.textContent = boardState.join("\n");
    
    setTimeout(() => {
        modal.style.display = "flex";
    }, 1500);
}

/* PaylaÅŸma Butonu */
document.getElementById("copyButton").onclick = () => {
    const text = `Duyuru Wordle ${boardState.length}/6\n\n${boardState.join("\n")}`;
    navigator.clipboard.writeText(text).then(() => {
        alert("SonuÃ§ panoya kopyalandÄ±!");
    });
};

/* Modal Kapatma (DÄ±ÅŸarÄ± tÄ±klayÄ±nca) */
window.onclick = (event) => {
    const modal = document.getElementById("resultModal");
    if (event.target == modal) modal.style.display = "none";
};

</script>
</body>
</html>

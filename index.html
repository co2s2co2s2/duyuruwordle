<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DUYURU WORDLE</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #fafafa;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      flex-direction: column;
    }

    .board {
      display: grid;
      grid-template-rows: repeat(6, 1fr);
      gap: 10px;
      justify-items: center;
      width: 100%;
    }

    .row {
      display: grid;
      grid-template-columns: repeat(5, 60px);
      gap: 10px;
    }

    .cell {
      width: 60px;
      height: 60px;
      border: 2px solid #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 32px;
      font-weight: bold;
      text-transform: uppercase;
      background: white;
    }

    .correct { background: #6aaa64; color: white; }
    .present { background: #c9b458; color: white; }
    .absent { background: #787c7e; color: white; }

    .keyboard {
      margin-top: 20px;
      text-align: center;
      width: 100%;
      max-width: 480px;
      padding: 0 10px;
      box-sizing: border-box;
    }

    .keyboard div {
      display: flex;
      justify-content: center;
      margin-bottom: 5px;
    }

    .key {
      padding: 10px 0;
      margin: 2px;
      min-width: 32px;
      flex: 1 1 auto;
      max-width: 48px;
      text-align: center;
      font-weight: bold;
      border-radius: 4px;
      border: none;
      background: #ddd;
      cursor: pointer;
      font-size: 16px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background-color: #fefefe;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      max-width: 400px;
      width: 90%;
    }

    #copyButton {
      margin-top: 15px;
      padding: 8px 16px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      background-color: #6aaa64;
      color: white;
      border-radius: 4px;
    }
  </style>
</head>
<body>

  <h1>DUYURU WORDLE</h1>
  <div class="board" id="board"></div>
  <div class="keyboard" id="keyboard"></div>

  <!-- Modal -->
  <div id="resultModal" class="modal">
    <div class="modal-content" id="modalContent">
      <div id="modalMessage" style="font-weight:bold;margin-bottom:10px;">TEBRÄ°KLER BÄ°LDÄ°N</div>
      <pre id="modalEmojis" style="white-space: pre-wrap; font-size: 18px; text-align:center;"></pre>
      <button id="copyButton">Kopyala</button>
    </div>
  </div>

<script>
let WORD_LIST = [];
let WORD = null;
let currentRow = 0;
let currentCol = 0;
let guesses = [];

// -------------------------
// TÃœRKÃ‡E NORMALÄ°ZASYON
// -------------------------
function normalizeTurkish(str) {
  return str
    .replace(/i/g, 'Ä°')
    .replace(/Ä±/g, 'I')
    .replace(/ÅŸ/g, 'Åž')
    .replace(/Ã§/g, 'Ã‡')
    .replace(/Ã¼/g, 'Ãœ')
    .replace(/Ã¶/g, 'Ã–')
    .replace(/ÄŸ/g, 'Äž')
    .toUpperCase();
}

// -------------------------
// HASH TABANLI GÃœN KELÄ°MESÄ°
// + bugÃ¼nÃ¼n kelimesi sabit
// -------------------------
async function getWordOfTheDay() {
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth() + 1).padStart(2, '0');
  const dd = String(today.getDate()).padStart(2, '0');

  const todayKey = `${yyyy}${mm}${dd}`;

  // -----------------------
  // 1) BUGÃœN SABÄ°T KELÄ°ME
  // -----------------------
  if (todayKey === "20251202") {
    const index = 20251202 % WORD_LIST.length;
    return WORD_LIST[index];
  }

  // -----------------------
  // 2) HASH TABANLI SEÃ‡Ä°M
  // -----------------------
  const encoder = new TextEncoder();
  const data = encoder.encode(todayKey);

  const hashBuffer = await crypto.subtle.digest("SHA-256", data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));

  const hashNum =
      (hashArray[0] << 24) |
      (hashArray[1] << 16) |
      (hashArray[2] << 8) |
      hashArray[3];

  const index = Math.abs(hashNum) % WORD_LIST.length;

  return WORD_LIST[index];
}

// -------------------------
// WORD LIST LOAD
// -------------------------
fetch("words.json")
  .then(res => res.json())
  .then(async list => {
    WORD_LIST = list.map(k => normalizeTurkish(k.trim()));
    WORD = await getWordOfTheDay();
    checkIfPlayed();
  })
  .catch(err => console.error("Kelime listesi yÃ¼klenemedi:", err));

// -------------------------
// BOARD OLUÅžTURMA
// -------------------------
const board = document.getElementById("board");
for (let r = 0; r < 6; r++) {
  const row = document.createElement("div");
  row.classList.add("row");
  for (let c = 0; c < 5; c++) {
    const cell = document.createElement("div");
    cell.classList.add("cell");
    cell.id = `cell-${r}-${c}`;
    row.appendChild(cell);
  }
  board.appendChild(row);
}

// -------------------------
// KLAVYE
// -------------------------
const keys = [
  ["Q","W","E","R","T","Y","U","I","O","P","Äž","Ãœ"],
  ["A","S","D","F","G","H","J","K","L","Åž","Ä°"],
  ["ENTER","Z","X","C","V","B","N","M","Ã–","Ã‡","DEL"]
];

const keyboard = document.getElementById("keyboard");
keys.forEach(rowKeys => {
  const rowDiv = document.createElement("div");
  rowKeys.forEach(k => {
    const btn = document.createElement("button");
    btn.textContent = k;
    btn.classList.add("key");
    btn.onclick = () => handleKey(k);
    rowDiv.appendChild(btn);
  });
  keyboard.appendChild(rowDiv);
});

// -------------------------
// INPUT
// -------------------------
function handleKey(key) {
  key = normalizeTurkish(key);
  const validChars = "ABCÃ‡DEFGÄžHIÄ°JKLMNOÃ–PRSÅžTUÃœVYZX";

  if (key === "DEL") return deleteLetter();
  if (key === "ENTER") return submitRow();
  if (!validChars.includes(key)) return;

  if (currentCol < 5) {
    const cell = document.getElementById(`cell-${currentRow}-${currentCol}`);
    cell.textContent = key;
    currentCol++;
  }
}

function deleteLetter() {
  if (currentCol > 0) {
    currentCol--;
    const cell = document.getElementById(`cell-${currentRow}-${currentCol}`);
    cell.textContent = "";
  }
}

// -------------------------
// KELÄ°ME DOÄžRULAMA
// -------------------------
function isValidWord(guess) {
  return WORD_LIST.includes(normalizeTurkish(guess));
}

function submitRow() {
  if (currentCol < 5) return;

  const guess = [];
  for (let c = 0; c < 5; c++) {
    const cell = document.getElementById(`cell-${currentRow}-${c}`);
    guess.push(cell.textContent);
  }

  const guessWord = guess.join("");
  if (!isValidWord(guessWord)) {
    alert("GeÃ§ersiz kelime!");
    return;
  }

  const result = checkGuess(guessWord);
  for (let c = 0; c < 5; c++) {
    const cell = document.getElementById(`cell-${currentRow}-${c}`);
    cell.classList.add(result[c]);
  }

  guesses.push({ guess: guessWord, result });

  if (result.every(r => r === "correct") || currentRow === 5) {
    saveResult();
    showShareableResult();
    return;
  }

  currentRow++;
  currentCol = 0;
}

function checkGuess(guess) {
  const res = Array(5).fill("absent");
  const target = WORD.split("");
  guess = normalizeTurkish(guess).split("");

  // doÄŸru yer
  for (let i = 0; i < 5; i++) {
    if (guess[i] === target[i]) {
      res[i] = "correct";
      target[i] = null;
    }
  }

  // yanlÄ±ÅŸ yer ama mevcut
  for (let i = 0; i < 5; i++) {
    if (res[i] !== "correct" && target.includes(guess[i])) {
      res[i] = "present";
      target[target.indexOf(guess[i])] = null;
    }
  }

  return res;
}

// -------------------------
// SONUÃ‡ MODAL
// -------------------------
function showShareableResult() {
  const modal = document.getElementById("resultModal");
  const modalEmojis = document.getElementById("modalEmojis");

  let output = `BUGÃœNÃœN 5'LÄ° DUYURU WORDLE'INI ${guesses.length} TAHMÄ°NDE Ã‡Ã–ZDÃœM.\n\n`;
  guesses.forEach(t => {
    let line = "";
    t.result.forEach(r => {
      if (r === "correct") line += "ðŸŸ©";
      else if (r === "present") line += "ðŸŸ§";
      else line += "â¬›";
    });
    output += line + "\n";
  });

  modalEmojis.textContent = output;
  modal.style.display = "flex";

  document.getElementById("copyButton").onclick = () => {
    navigator.clipboard.writeText(output);
    alert("SonuÃ§ kopyalandÄ±!");
  };
}

function saveResult() {
  const today = new Date().toISOString().slice(0,10);
  localStorage.setItem('duyuruWordlePlayed', JSON.stringify({ date: today, result: guesses }));
}

function checkIfPlayed() {
  const played = JSON.parse(localStorage.getItem('duyuruWordlePlayed'));
  const today = new Date().toISOString().slice(0,10);
  if (played && played.date === today) {
    guesses = played.result;
    showShareableResult();
    return true;
  }
  return false;
}

window.onclick = function(event) {
  const modal = document.getElementById("resultModal");
  if (event.target === modal) {
    modal.style.display = "none";
  }
};
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Duyuru Wordle 0.660</title>
<style>
body { font-family: Arial, sans-serif; background:#fafafa; display:flex; justify-content:center; align-items:center; height:100vh; margin:0; flex-direction:column; }
.board { display:grid; grid-template-rows:repeat(6,1fr); gap:10px; justify-items:center; }
.row { display:grid; grid-template-columns:repeat(5,60px); gap:10px; }
.cell { width:60px; height:60px; border:2px solid #ccc; display:flex; justify-content:center; align-items:center; font-size:32px; font-weight:bold; background:white; }
@keyframes shake {0%{transform:translateX(0);}20%{transform:translateX(-6px);}40%{transform:translateX(6px);}60%{transform:translateX(-6px);}80%{transform:translateX(6px);}100%{transform:translateX(0);}}
.row.shake { animation:shake 0.4s; }
.correct { background:#6aaa64; color:white; } .present { background:#c9b458; color:white; } .absent { background:#787c7e; color:white; }
.keyboard { margin-top:20px; text-align:center; max-width:480px; } .keyboard div { display:flex; justify-content:center; margin-bottom:5px; }
.key { padding:10px; margin:2px; min-width:32px; max-width:48px; font-weight:bold; border-radius:4px; border:none; background:#ddd; cursor:pointer; }
.key.correct { background:#6aaa64; color:white; } .key.present { background:#c9b458; color:white; } .key.absent { background:#787c7e; color:white; }
.modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); justify-content:center; align-items:center; }
.modal-content { background:white; padding:20px; border-radius:8px; text-align:center; max-width:400px; width:90%; position:relative; }
#modalClose { position:absolute; top:8px; right:12px; font-size:22px; cursor:pointer; }
#copyButton, #newGameButton { margin-top:12px; padding:8px 16px; background:#6aaa64; color:white; border:none; border-radius:4px; cursor:pointer; }
#newGameButton { display:none; margin-left:10px; }
</style>
</head>
<body>
<h1>Duyuru Wordle 0.660</h1>
<div class="board" id="board"></div>
<div class="keyboard" id="keyboard"></div>
<div id="resultModal" class="modal">
  <div class="modal-content">
    <span id="modalClose">&times;</span>
    <div id="modalMessage"></div>
    <pre id="modalEmojis"></pre>
    <button id="copyButton">Kopyala</button>
    <button id="newGameButton">Yeni Oyun</button>
  </div>
</div>
<script>
let DEV_MODE=false;
window.devOn=()=>{DEV_MODE=true; console.warn("DEV MODE AKTÄ°F"); console.log("BUGÃœNÃœN KELÄ°MESÄ°:", WORD); document.getElementById("newGameButton").style.display="inline-block";};
window.devOff=()=>{DEV_MODE=false; console.warn("DEV MODE KAPATILDI"); document.getElementById("newGameButton").style.display="none";};

let WORD_LIST=[], WORD=null, currentRow=0, currentCol=0, guesses=[], guessesWords=[];

// --- UTILS ---
function normalizeTurkish(str){return str.replace(/i/g,'Ä°').replace(/Ä±/g,'I').replace(/ÅŸ/g,'Åž').replace(/Ã§/g,'Ã‡').replace(/Ã¼/g,'Ãœ').replace(/Ã¶/g,'Ã–').replace(/ÄŸ/g,'Äž').toUpperCase();}
async function getDailyWord(){
  const tr=new Date(Date.now()+3*60*60*1000);
  const dateStr=tr.toISOString().slice(0,10);
  const data=new TextEncoder().encode(dateStr);
  const hash=await crypto.subtle.digest("SHA-256", data);
  const arr=Array.from(new Uint8Array(hash));
  const idx=arr.reduce((a,v)=> (a*31+v)%WORD_LIST.length,0);
  return WORD_LIST[idx];
}

// --- LOAD WORDS ---
fetch("words.json").then(r=>r.json()).then(async list=>{
  WORD_LIST=list.map(w=>normalizeTurkish(w.trim()));
  WORD=await getDailyWord();
  if(!DEV_MODE) loadFromStorage();
  renderBoard();
  renderKeyboard();
  if(isGameFinished()) openModalForFinishedGame();
});

// --- BOARD ---
const board=document.getElementById("board");
for(let r=0;r<6;r++){
  const row=document.createElement("div"); row.className="row"; row.id=`row-${r}`;
  for(let c=0;c<5;c++){ const cell=document.createElement("div"); cell.className="cell"; cell.id=`cell-${r}-${c}`; row.appendChild(cell); }
  board.appendChild(row);
}

// --- KEYBOARD ---
const keys=[["Q","W","E","R","T","Y","U","I","O","P","Äž","Ãœ"],["A","S","D","F","G","H","J","K","L","Åž","Ä°"],["ENTER","Z","X","C","V","B","N","M","Ã–","Ã‡","DEL"]];
const keyboard=document.getElementById("keyboard");
function renderKeyboard(){
  keyboard.innerHTML='';
  keys.forEach(r=>{
    const d=document.createElement("div");
    r.forEach(k=>{
      const b=document.createElement("button");
      b.className="key"; b.textContent=k; b.onclick=()=>handleKey(k);
      d.appendChild(b);
    });
    keyboard.appendChild(d);
  });
  guesses.forEach((res,i)=>{ const g=guessesWords[i]; updateKeyboard(g,res); });
}

// --- INPUT ---
function handleKey(k){
  k=normalizeTurkish(k);
  if(k==="DEL") return del();
  if(k==="ENTER") return submit();
  if(currentCol<5){ document.getElementById(`cell-${currentRow}-${currentCol}`).textContent=k; currentCol++; }
}
function del(){ if(currentCol>0){ currentCol--; document.getElementById(`cell-${currentRow}-${currentCol}`).textContent=""; } }
function clearCurrentRow(){ for(let i=0;i<5;i++){ document.getElementById(`cell-${currentRow}-${i}`).textContent=""; } currentCol=0; }
function shakeRow(){ const row=document.getElementById(`row-${currentRow}`); row.classList.add("shake"); setTimeout(()=>{ row.classList.remove("shake"); clearCurrentRow(); },400); }

function submit(){
  if(currentCol<5) return;
  const g=[...Array(5)].map((_,i)=>document.getElementById(`cell-${currentRow}-${i}`).textContent).join("");
  if(!WORD_LIST.includes(g)){ shakeRow(); return; }
  const res=check(g);
  guesses.push(res); guessesWords.push(g);
  res.forEach((r,i)=>document.getElementById(`cell-${currentRow}-${i}`).classList.add(r));
  updateKeyboard(g,res);
  if(!DEV_MODE) saveToStorage();
  if(res.every(r=>r==="correct")){ showModal(getFunnyMessage(guesses.length,true), generateEmojiBoard()); return; }
  if(currentRow===5){ showModal(getFunnyMessage(guesses.length,false), generateEmojiBoard()); return; }
  currentRow++; currentCol=0;
}

// --- CHECK ---
function check(g){ const res=Array(5).fill("absent"); const t=WORD.split(""); g=g.split(""); for(let i=0;i<5;i++) if(g[i]===t[i]){ res[i]="correct"; t[i]=null; } for(let i=0;i<5;i++) if(res[i]!=="correct" && t.includes(g[i])){ res[i]="present"; t[t.indexOf(g[i])]=null; } return res; }

// --- KEYBOARD UPDATE ---
function updateKeyboard(g,res){
  for(let i=0;i<5;i++){
    const key=g[i];
    const btn=Array.from(document.getElementsByClassName("key")).find(b=>b.textContent===key);
    if(!btn) continue;
    if(res[i]==="correct") btn.classList.remove("present","absent"), btn.classList.add("correct");
    else if(res[i]==="present" && !btn.classList.contains("correct")) btn.classList.remove("absent"), btn.classList.add("present");
    else if(res[i]==="absent" && !btn.classList.contains("correct") && !btn.classList.contains("present")) btn.classList.add("absent");
  }
}

// --- MODAL ---
function getFunnyMessage(guessCount,success){
  if(success){
    const messages=["Vay be, sÃ¼per zekÃ¢! ðŸ˜ŽðŸ’¥","Harika! Ä°yi iÅŸ Ã§Ä±kardÄ±n ðŸ˜","Fena deÄŸil, sonunda Ã§Ã¶zdÃ¼n ðŸ˜„","Hmm, biraz uÄŸraÅŸtÄ±n ama baÅŸardÄ±n ðŸ˜…","Ufff, zorlandÄ±n ama Ã§Ã¶zdÃ¼n ðŸ˜¬","Aaah, sonunda, iyi kÃ¶tÃ¼ ðŸ˜…"];
    return messages[Math.min(guessCount-1,messages.length-1)];
  } else { return `Bu sefer olmadÄ± ðŸ˜­ Kelime: ${WORD}`; }
}
function showModal(message,emojis=""){
  document.getElementById("modalMessage").textContent=message;
  document.getElementById("modalEmojis").textContent=emojis;
  document.getElementById("resultModal").style.display="flex";
  if(DEV_MODE) document.getElementById("newGameButton").style.display="inline-block";
}
document.getElementById("modalClose").onclick=()=>document.getElementById("resultModal").style.display="none";
document.getElementById("copyButton").onclick=()=>{
  const text=`${document.getElementById("modalMessage").textContent}\n${document.getElementById("modalEmojis").textContent}`;
  navigator.clipboard.writeText(text);
}

// --- NEW GAME DEV BUTTON ---
document.getElementById("newGameButton").onclick=()=>{
  guesses=[]; guessesWords=[]; currentRow=0; currentCol=0;
  renderBoard(); renderKeyboard(); document.getElementById("resultModal").style.display="none";
}

// --- EMOJI BOARD ---
function generateEmojiBoard(){ return guesses.map(r=>r.map(s=>s==="correct"?"ðŸŸ©":s==="present"?"ðŸŸ¨":"â¬›").join("")).join("\n"); }

// --- LOCAL STORAGE ---
function saveToStorage(){
  localStorage.setItem("dw_guesses",JSON.stringify(guesses));
  localStorage.setItem("dw_guessesWords",JSON.stringify(guessesWords));
  localStorage.setItem("dw_currentRow",currentRow);
  localStorage.setItem("dw_word",WORD);
}

function loadFromStorage(){
  const storedWord = localStorage.getItem("dw_word");
  if(storedWord && WORD_LIST.includes(storedWord)) WORD=storedWord;
  const g=JSON.parse(localStorage.getItem("dw_guesses")||"[]");
  const gw=JSON.parse(localStorage.getItem("dw_guessesWords")||"[]");
  const cr=parseInt(localStorage.getItem("dw_currentRow")||"0");
  guesses=g; guessesWords=gw; currentRow=cr;
}

// --- RENDER ---
function renderBoard(){
  guesses.forEach((res,rowIdx)=>{
    const g = guessesWords[rowIdx];
    for(let i=0;i<5;i++){
      const cell=document.getElementById(`cell-${rowIdx}-${i}`);
      cell.textContent = g[i];
      cell.classList.add(res[i]);
    }
  });
}

function isGameFinished(){
  return guesses.some(r=>r.every(c=>c==="correct")) || currentRow>=6;
}

function openModalForFinishedGame(){
  const lastRes = guesses[guesses.length-1];
  const success = lastRes.every(c=>c==="correct");
  showModal(getFunnyMessage(guesses.length,success), generateEmojiBoard());
}
</script>
</body>
</html>
